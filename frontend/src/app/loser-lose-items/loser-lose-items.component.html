<h2 class="fancy-title">üìÅ My Lost Items</h2>


<mat-form-field appearance="outline" class="filter-input">
  <mat-label>Search</mat-label>
  <input matInput (keyup)="applyFilter($event)" placeholder="Type to search">
</mat-form-field>

<mat-spinner *ngIf="isLoading" diameter="40"></mat-spinner>

<table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8" *ngIf="!isLoading" multiTemplateDataRows>

  <!-- Expand Toggle -->
  <ng-container matColumnDef="expandToggle">
  <th mat-header-cell *matHeaderCellDef></th> <!-- ‚úÖ MISSING HEADER CELL -->
  <td mat-cell *matCellDef="let element">
    <button mat-icon-button *ngIf="!element.detailRow" (click)="expandedElement = expandedElement === element ? null : element">
      <mat-icon>{{ expandedElement === element ? 'expand_less' : 'expand_more' }}</mat-icon>
    </button>
  </td>
</ng-container>

<!-- ID -->
<ng-container matColumnDef="id">
  <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
  <td mat-cell *matCellDef="let element">{{ element.id }}</td>
</ng-container>

  <!-- Name -->
  <ng-container matColumnDef="name">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
    <td mat-cell *matCellDef="let element">{{ element.name }}</td>
  </ng-container>

  <!-- Location -->
  <ng-container matColumnDef="location">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>Location</th>
    <td mat-cell *matCellDef="let element">{{ element.location }}</td>
  </ng-container>
  <!-- City -->
<ng-container matColumnDef="city">
  <th mat-header-cell *matHeaderCellDef mat-sort-header>City</th>
  <td mat-cell *matCellDef="let element">{{ element.city }}</td>
</ng-container>


  <!-- Description -->
  <ng-container matColumnDef="description">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>Description</th>
    <td mat-cell *matCellDef="let element">{{ element.description }}</td>
  </ng-container>

  <!-- Lost Date -->
  <ng-container matColumnDef="lostDate">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>Lost Date</th>
    <td mat-cell *matCellDef="let element">{{ element.lostDate | date }}</td>
  </ng-container>

  <!-- Image -->
  <ng-container matColumnDef="image">
    <th mat-header-cell *matHeaderCellDef>Image</th>
    <td mat-cell *matCellDef="let element">
      <img
  *ngIf="element.imageUrl || element.imagePath"
  [src]="element.imageUrl || ('http://localhost:8080' + element.imagePath)"
  alt="Item Image"
  height="100"
/>
<span *ngIf="!element.imageUrl && !element.imagePath">No image available</span>

    </td>
  </ng-container>

  <!-- Actions -->
  <ng-container matColumnDef="actions">
    <th mat-header-cell *matHeaderCellDef>Actions</th>
    <td mat-cell *matCellDef="let element">
      <button mat-icon-button color="primary" [routerLink]="['/loser/edit-lost-item', element.id]" *ngIf="!element.detailRow">
        <mat-icon>edit</mat-icon>
      </button>
      <button mat-icon-button color="warn" (click)="deleteItem(element.id)" *ngIf="!element.detailRow">
        <mat-icon>delete</mat-icon>
      </button>
    </td>
  </ng-container>

 <!-- Expanded Detail Row -->
<ng-container matColumnDef="detail">
  <td mat-cell *matCellDef="let element" [attr.colspan]="displayedColumns.length">
    <div class="item-details" *ngIf="expandedElement === element">
      <p><strong>ID:</strong> {{ element.id }}</p>
      <p><strong>Name:</strong> {{ element.name }}</p> <!-- ‚úÖ Add this line -->
      <p><strong>Location:</strong> {{ element.location }}</p>
      <p><strong>City:</strong> {{ element.city }}</p>
      <p><strong>Description:</strong> {{ element.description }}</p>
      <p><strong>Lost Date:</strong> {{ element.lostDate | date }}</p>
      <p><strong>Extra Info:</strong> {{ element.additionalInfo }}</p>

      <img *ngIf="element.imageUrl" [src]="element.imageUrl" alt="Item Image" height="100" />
      <span *ngIf="!element.imageUrl">No image available</span>
    </div>
  </td>
</ng-container>



  <!-- Header Row -->
  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

  <!-- Normal Rows -->
  <tr mat-row
      *matRowDef="let row; columns: displayedColumns;"
      [class.expanded]="expandedElement === row"
      [hidden]="row.detailRow">
  </tr>

  <!-- Detail Row -->
  <tr mat-row
      *matRowDef="let row; columns: ['detail']; when: isExpansionDetailRow"
      class="detail-row">
  </tr>

</table>

<mat-paginator [pageSize]="5" showFirstLastButtons></mat-paginator>
